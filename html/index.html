<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>数据对比</title>
    <!--vue-->
    <script src="../js/vue.min.js"></script>
    <script src="../js/echarts.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>

    <!--boot strap css-->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css">

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    <!-- popper.min.js 用于弹窗、提示、下拉菜单 -->
    <script src="https://cdn.bootcss.com/popper.js/1.12.5/umd/popper.min.js"></script>

    <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">

          </div>
        </div>

        <div class="row">
            <div class="col-2" ></div>
            <div class="col-8" id="app" style="background: #F7F7F9">
                <h2 class="text-center" style="height: 100px;margin-top: 100px">
                    数据对比
                </h2>
                <div class="form-inline">
                        <div class="form-group" style="margin: 40px">
                            <div class="input-group-addon" style="margin-left: 100px;margin-right: 40px">URL</div>
                            <input type="text" class="form-control" id="dataUrl" style="width: 400px" placeholder="Enter url" v-model = "newUrl">
                        </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" v-on:click="initMap">Submit</button>
                    </div>
                </div>
                <div class="span12" id="box" style="width: 1000px; height:500px;"></div>
            </div>
            <div class="col-2" ></div>
        </div>
    </div>
<script>
    // ajax获取数据源
    var myChart;
    var vm =new Vue({
        el: '#app',
        data:{
            newUrl :'',
            dataList : [],
            //抬头
            legend : [],
            //x轴
            xAxisData : [],
            yAxisData : [],

        },
        methods:{
            //在线版
            // getData:function(){
            //     this.$http.jsonp(vm.newUrl,
            //         {params:{
            //                 word:'a'
            //             }}
            //     ).then(resp=> {
            //         console.log(resp.data)
            // })

            //本地版
            getData:function(){
                $.ajax({
                    type: "POST",//请求方式
                    url: vm.newUrl,//地址，就是json文件的请求路径
                    async: false,
                    dataType: "json",//数据类型可以为 text xml json  script  jsonp
                    success: function(result){//返回的参数就是 action里面所有的有get和set方法的参数
                        //console.log(result);
                        vm.dataList.push(result)
                        //console.log(vm.dataList);
                        //生成x轴
                        var dataListEle = vm.dataList[0];
                        vm.xAxisData = [];
                        dataListEle.data.forEach(function (item) {
                            vm.xAxisData.push(item.x)
                        })

                        vm.legend = [];
                        vm.yAxisData = [];
                        vm.dataList.forEach(function(item,index){
                            //生成legend
                            var legendEle = 'DATA_' + index;
                            vm.legend.push(legendEle);
                            //生成y轴
                            var yAxisEle = {
                                name: legendEle,
                                type: 'line',
                                stack: '总量'+legendEle,
                                data: []};
                            item.data.forEach(function(arrData){
                                    yAxisEle.data.push(arrData.y);
                            })
                            vm.yAxisData.push(yAxisEle);
                        })

                    }
                });
                var mapData = [];
                mapData.push(vm.legend);
                mapData.push(vm.xAxisData);
                mapData.push(vm.yAxisData);
                console.log(mapData);
                return mapData
            },

            initMap:function () {
                var mapData = this.getData();
                if (myChart != null && myChart != "" && myChart != undefined) {
                    myChart.dispose();
                }
                myChart = echarts.init(document.getElementById("box"));


                // option 里面的内容基本涵盖你要画的图表的所有内容
                // 定义样式和数据
                option = {
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: mapData[0]
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            mark: {show: true},
                            dataView: {show: true, readOnly: false},
                            magicType: {show: true, type: ['line', 'bar', 'stack', 'tiled']},
                            restore: {show: true},
                            saveAsImage: {show: true}
                        }
                    },
                    calculable: true,
                    xAxis: [
                        {
                            type: 'category',
                            boundaryGap: false,
                            data: mapData[1]
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value'
                        }
                    ],
                    series: mapData[2]
                };
                myChart.clear();
                myChart.setOption(option,true);
                
            }
        }
    })

</script>

</body>

</html>
